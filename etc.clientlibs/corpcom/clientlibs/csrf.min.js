(function(c,p){c.Granite=c.Granite||{};c.Granite.HTTP=c.Granite.HTTP||{};var d=null;c.Granite.HTTP.externalize=c.Granite.HTTP.externalize||function(e){if(null===d)a:{var k=/^(?:http|https):\/\/[^\/]+(\/.*)\/(?:etc\.clientlibs|etc(\/.*)*\/clientlibs|libs(\/.*)*\/clientlibs|apps(\/.*)*\/clientlibs|etc\/designs).*\.js(\?.*)?$/;try{if(c.CQURLInfo)d=CQURLInfo.contextPath||"";else{for(var l=document.getElementsByTagName("script"),g=0;g<l.length;g++){var m=k.exec(l[g].src);if(m){d=m[1];break a}}d=""}}catch(f){}}try{0==
e.indexOf("/")&&d&&0!=e.indexOf(d+"/")&&(e=d+e)}catch(f){}return e}})(this);
(function(c,p){function d(){this._handler=[]}function e(a){var b="//"+document.location.host,c=document.location.protocol+b;return a==c||a.slice(0,c.length+1)==c+"/"||a==b||a.slice(0,b.length+1)==b+"/"||!/^(\/\/|http:|https:).*/.test(a)}function k(){f=new d;var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)try{h=JSON.parse(a.responseText).token,f.resolve(h)}catch(b){f.reject(a.responseText)}};a.open("GET",Granite.HTTP.externalize(m),!0);a.send();return f}function l(a){var b=
a.getAttribute("action");"GET"===a.method.toUpperCase()||b&&!e(b)||(b=a.querySelector('input[name\x3d":cq_csrf_token"]'),b||(b=document.createElement("input"),b.setAttribute("type","hidden"),b.setAttribute("name",":cq_csrf_token"),a.appendChild(b)),b.setAttribute("value",h))}function g(a){var b=function(a){a=a.target;"form"===a.nodeName.toLowerCase()&&h&&l(a)};a.addEventListener?a.addEventListener("submit",b,!0):a.attachEvent&&a.attachEvent("submit",b)}c.Granite=c.Granite||{};if(!c.Granite.csrf){c.Granite.csrf=
{initialised:!1,refreshToken:k};d.prototype={then:function(a,b){this._handler.push({resolve:a,reject:b})},resolve:function(){this._execute("resolve",arguments)},reject:function(){this._execute("reject",arguments)},_execute:function(a,b){if(null===this._handler)throw Error("Promise already completed.");for(var d=0,e=this._handler.length;d<e;d++)this._handler[d][a].apply(c,b);this.then=function(d,e){("resolve"===a?d:e).apply(c,b)};this._handler=null}};var m="/libs/granite/csrf/token.json",f,h;k();g(document);
var q=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(a,b){e(b)&&"get"!==a.toLowerCase()&&(this._csrf=!0);return q.apply(this,arguments)};var n=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(a){if(this._csrf)if(h)this.setRequestHeader("CSRF-Token",h),n.apply(this,arguments);else{var b=this,d=Array.prototype.slice.call(arguments);f.then(function(a){b.setRequestHeader("CSRF-Token",a);n.apply(b,d)},function(){c.console&&console.error("Unable to read CSRF meta information");
n.apply(b,d)})}else n.apply(this,arguments)};var r=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=function(){l(this);return r.apply(this,arguments)};if(c.Node){var t=Node.prototype.appendChild;Node.prototype.appendChild=function(){var a=t.apply(this,arguments);if("IFRAME"===a.nodeName)try{a.contentWindow&&!a._csrf&&(a._csrf=!0,g(a.contentWindow.document))}catch(b){a.src&&a.src.length&&e(a.src)&&c.console&&console.error("Unable to attach CSRF token an iframe element on the same origin")}return a}}setInterval(function(){k()},
3E5)}})(this);